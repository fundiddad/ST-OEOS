# å¹¶å‘ç”Ÿæˆå™¨ V1 vs V2 å¯¹æ¯”

## ğŸ“Š æ ¸å¿ƒåŒºåˆ«

| ç‰¹æ€§ | V1 (concurrent-generator.js) | V2 (concurrent-generator-v2.js) |
|------|------------------------------|----------------------------------|
| **æ¶ˆæ¯ä¿å­˜** | âŒ ä¸ä¿å­˜åˆ°èŠå¤©è®°å½• | âœ… ä¿å­˜åˆ°èŠå¤©è®°å½• |
| **UIæ˜¾ç¤º** | âŒ ä¸æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢ | âœ… æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢ |
| **å‘é€æŒ‰é’®çŠ¶æ€** | âš ï¸ ä¼šè§¦å‘"æ­£åœ¨è¯·æ±‚"çŠ¶æ€ | âœ… ä¸è§¦å‘ |
| **å®ç°æ–¹å¼** | ä½¿ç”¨ `quiet` æ¨¡å¼ + æ•è·é…ç½® | æ‰‹åŠ¨æ·»åŠ æ¶ˆæ¯ + ç›´æ¥è°ƒç”¨API |
| **é…ç½®è·å–** | ç›‘å¬ `CHAT_COMPLETION_SETTINGS_READY` | ç›‘å¬ `GENERATE_AFTER_DATA` |
| **é€‚ç”¨åœºæ™¯** | åå°é¢„ç”Ÿæˆï¼Œä¸éœ€è¦æ˜¾ç¤º | æ­£å¸¸èŠå¤©ï¼Œéœ€è¦ä¿å­˜å’Œæ˜¾ç¤º |

---

## ğŸ”§ V1 å®ç°åŸç†

### å·¥ä½œæµç¨‹

```
1. è°ƒç”¨ context.generate('quiet', { quiet_prompt: 'goto: pageId' })
2. ç›‘å¬ CHAT_COMPLETION_SETTINGS_READY äº‹ä»¶æ•è·å®Œæ•´é…ç½®
3. ç«‹å³ abortï¼Œåªè·å–é…ç½®ä¸çœŸæ­£ç”Ÿæˆ
4. ä½¿ç”¨æ•è·çš„é…ç½®ç›´æ¥è°ƒç”¨åç«¯API
5. æµå¼æ¥æ”¶å“åº”
6. âŒ ä¸ä¿å­˜åˆ°èŠå¤©è®°å½•
```

### ä¼˜ç‚¹
- âœ… ç®€å•ç›´æ¥
- âœ… å®Œå…¨å¤ç”¨STçš„é…ç½®é€»è¾‘
- âœ… ä»£ç é‡å°‘ï¼ˆ~383è¡Œï¼‰

### ç¼ºç‚¹
- âŒ ä¸ä¿å­˜åˆ°èŠå¤©è®°å½•
- âŒ ä¸æ˜¾ç¤ºåœ¨UI
- âŒ ä¼šè§¦å‘å‘é€æŒ‰é’®çŠ¶æ€å˜åŒ–
- âŒ ç”¨æˆ·çœ‹ä¸åˆ°ç”Ÿæˆçš„å†…å®¹

---

## ğŸ”§ V2 å®ç°åŸç†

### å·¥ä½œæµç¨‹

```
1. æ‰‹åŠ¨æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ° context.chat æ•°ç»„
2. æ‰‹åŠ¨æ·»åŠ AIæ¶ˆæ¯æ§½ä½åˆ° context.chat æ•°ç»„
3. åˆ·æ–°UIæ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
4. è°ƒç”¨ context.generate('normal', ..., dryRun=true) è·å–æ¶ˆæ¯æ•°ç»„
5. ä½¿ç”¨æ¶ˆæ¯æ•°ç»„ç›´æ¥è°ƒç”¨åç«¯API
6. æµå¼æ¥æ”¶å“åº”ï¼Œå®æ—¶æ›´æ–°AIæ¶ˆæ¯
7. æ¯æ¬¡æ›´æ–°ååˆ·æ–°UI
8. âœ… ä¿å­˜èŠå¤©è®°å½•åˆ°æ–‡ä»¶
```

### ä¼˜ç‚¹
- âœ… ä¿å­˜åˆ°èŠå¤©è®°å½•
- âœ… æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢
- âœ… ä¸è§¦å‘å‘é€æŒ‰é’®çŠ¶æ€
- âœ… ç”¨æˆ·å¯ä»¥çœ‹åˆ°å®Œæ•´çš„å¯¹è¯å†å²

### ç¼ºç‚¹
- âš ï¸ ä»£ç ç¨å¤æ‚ï¼ˆ~350è¡Œï¼‰
- âš ï¸ éœ€è¦æ‰‹åŠ¨ç®¡ç†æ¶ˆæ¯ç´¢å¼•
- âš ï¸ éœ€è¦æ‰‹åŠ¨åˆ·æ–°UI

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### V1 ä½¿ç”¨ç¤ºä¾‹

```javascript
import { getConcurrentGenerator } from './concurrent-generator.js';

const generator = getConcurrentGenerator();

// ç”Ÿæˆå•ä¸ªé¡µé¢ï¼ˆä¸ä¿å­˜åˆ°èŠå¤©è®°å½•ï¼‰
const text = await generator.generatePage(1, 'forest');
console.log('ç”Ÿæˆçš„æ–‡æœ¬:', text);

// å¹¶å‘ç”Ÿæˆå¤šä¸ªé¡µé¢
const tasks = [
    generator.generatePage(1, 'page1'),
    generator.generatePage(2, 'page2'),
    generator.generatePage(3, 'page3')
];
const results = await Promise.all(tasks);
```

### V2 ä½¿ç”¨ç¤ºä¾‹

```javascript
import { getConcurrentGeneratorV2 } from './concurrent-generator-v2.js';

const generator = getConcurrentGeneratorV2();

// ç”Ÿæˆå•ä¸ªé¡µé¢ï¼ˆä¿å­˜åˆ°èŠå¤©è®°å½•å¹¶æ˜¾ç¤ºï¼‰
const text = await generator.generatePage(1, 'forest');
console.log('ç”Ÿæˆçš„æ–‡æœ¬:', text);

// å¹¶å‘ç”Ÿæˆå¤šä¸ªé¡µé¢
const tasks = [
    generator.generatePage(1, 'page1'),
    generator.generatePage(2, 'page2'),
    generator.generatePage(3, 'page3')
];
const results = await Promise.all(tasks);

// æŸ¥è¯¢ä¼šè¯çŠ¶æ€
const status = generator.getSessionStatus(1);
console.log('ä¼šè¯çŠ¶æ€:', status);

// å–æ¶ˆç”Ÿæˆ
generator.cancelGeneration(1);
```

---

## ğŸ¯ é€‰æ‹©å»ºè®®

### ä½¿ç”¨ V1 çš„åœºæ™¯

1. **åå°é¢„ç”Ÿæˆ**
   - é¢„ç”Ÿæˆä¸‹ä¸€å±‚é¡µé¢
   - ä¸éœ€è¦æ˜¾ç¤ºåœ¨UI
   - ä¸éœ€è¦ä¿å­˜åˆ°èŠå¤©è®°å½•

2. **ä¸´æ—¶æµ‹è¯•**
   - å¿«é€Ÿæµ‹è¯•ç”Ÿæˆæ•ˆæœ
   - ä¸æƒ³æ±¡æŸ“èŠå¤©å†å²

### ä½¿ç”¨ V2 çš„åœºæ™¯

1. **æ­£å¸¸æ¸¸æˆæµç¨‹**
   - ç”¨æˆ·ç‚¹å‡»é€‰é¡¹è§¦å‘ç”Ÿæˆ
   - éœ€è¦æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢
   - éœ€è¦ä¿å­˜åˆ°èŠå¤©è®°å½•

2. **è°ƒè¯•å’Œå¼€å‘**
   - éœ€è¦æŸ¥çœ‹å®Œæ•´çš„å¯¹è¯å†å²
   - éœ€è¦ä¿å­˜ç”Ÿæˆç»“æœä¾›åç»­åˆ†æ

3. **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**
   - ç”¨æˆ·éœ€è¦çœ‹åˆ°AIçš„å›å¤
   - ç”¨æˆ·éœ€è¦èƒ½å¤Ÿå›æº¯å†å²å¯¹è¯

---

## ğŸ”„ è¿ç§»æŒ‡å—

### ä» V1 è¿ç§»åˆ° V2

1. **ä¿®æ”¹å¯¼å…¥**

```javascript
// æ—§ä»£ç 
import { getConcurrentGenerator } from './concurrent-generator.js';
const generator = getConcurrentGenerator();

// æ–°ä»£ç 
import { getConcurrentGeneratorV2 } from './concurrent-generator-v2.js';
const generator = getConcurrentGeneratorV2();
```

2. **APIå®Œå…¨å…¼å®¹**

V2çš„APIä¸V1å®Œå…¨å…¼å®¹ï¼Œæ— éœ€ä¿®æ”¹è°ƒç”¨ä»£ç ï¼š

```javascript
// è¿™æ®µä»£ç åœ¨V1å’ŒV2ä¸­éƒ½èƒ½æ­£å¸¸å·¥ä½œ
const text = await generator.generatePage(1, 'forest');
```

3. **æ–°å¢åŠŸèƒ½**

V2æ–°å¢äº†ä¸€äº›åŠŸèƒ½ï¼š

```javascript
// æŸ¥è¯¢ä¼šè¯çŠ¶æ€
const status = generator.getSessionStatus(1);

// å–æ¶ˆç”Ÿæˆ
generator.cancelGeneration(1);
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### V1 æ³¨æ„äº‹é¡¹

1. **å‘é€æŒ‰é’®çŠ¶æ€**
   - è°ƒç”¨ `context.generate()` ä¼šè§¦å‘å‘é€æŒ‰é’®å˜ä¸º"æ­£åœ¨è¯·æ±‚"çŠ¶æ€
   - è™½ç„¶ä¼šç«‹å³abortï¼Œä½†UIçŠ¶æ€å¯èƒ½ä¼šé—ªçƒ

2. **èŠå¤©è®°å½•**
   - ç”Ÿæˆçš„å†…å®¹ä¸ä¼šä¿å­˜åˆ°èŠå¤©è®°å½•
   - åˆ·æ–°é¡µé¢åå†…å®¹ä¼šä¸¢å¤±

### V2 æ³¨æ„äº‹é¡¹

1. **èŠå¤©å†å²æ±¡æŸ“**
   - æ‰€æœ‰ç”Ÿæˆçš„å†…å®¹éƒ½ä¼šä¿å­˜åˆ°èŠå¤©è®°å½•
   - å¦‚æœç”Ÿæˆå¤±è´¥ï¼Œé”™è¯¯æ¶ˆæ¯ä¹Ÿä¼šä¿å­˜
   - å»ºè®®åœ¨ç”Ÿæˆå‰æç¤ºç”¨æˆ·

2. **UIåˆ·æ–°æ€§èƒ½**
   - æ¯æ¬¡æ›´æ–°éƒ½ä¼šåˆ·æ–°UI
   - å¦‚æœå¹¶å‘ç”Ÿæˆå¤ªå¤šé¡µé¢ï¼Œå¯èƒ½ä¼šå½±å“æ€§èƒ½
   - å»ºè®®é™åˆ¶å¹¶å‘æ•°é‡ï¼ˆæœ€å¤š10ä¸ªï¼‰

3. **æ¶ˆæ¯ç´¢å¼•ç®¡ç†**
   - V2éœ€è¦æ‰‹åŠ¨ç®¡ç†æ¶ˆæ¯åœ¨chatæ•°ç»„ä¸­çš„ç´¢å¼•
   - å¦‚æœå…¶ä»–ä»£ç ä¹Ÿåœ¨ä¿®æ”¹chatæ•°ç»„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç´¢å¼•é”™è¯¯
   - å»ºè®®åœ¨ç”ŸæˆæœŸé—´é¿å…å…¶ä»–æ“ä½œ

---

## ğŸš€ æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | V1 | V2 |
|------|----|----|
| **å†…å­˜å ç”¨** | ä½ | ä¸­ï¼ˆéœ€è¦å­˜å‚¨æ¶ˆæ¯ç´¢å¼•ï¼‰ |
| **CPUå ç”¨** | ä½ | ä¸­ï¼ˆéœ€è¦é¢‘ç¹åˆ·æ–°UIï¼‰ |
| **ç½‘ç»œè¯·æ±‚** | ç›¸åŒ | ç›¸åŒ |
| **ç£ç›˜IO** | æ—  | æœ‰ï¼ˆä¿å­˜èŠå¤©è®°å½•ï¼‰ |
| **å¹¶å‘èƒ½åŠ›** | 10ä¸ªæ§½ä½ | 10ä¸ªæ§½ä½ |

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [concurrent-generator.js](./concurrent-generator.js) - V1å®ç°
- [concurrent-generator-v2.js](./concurrent-generator-v2.js) - V2å®ç°
- [test-concurrent-v2.js](./test-concurrent-v2.js) - V2æµ‹è¯•æ–‡ä»¶
- [ARCHITECTURE.md](../ARCHITECTURE.md) - æ¶æ„æ–‡æ¡£

---

## ğŸ”® æœªæ¥è®¡åˆ’

### V3 å¯èƒ½çš„æ”¹è¿›

1. **æ··åˆæ¨¡å¼**
   - æ”¯æŒé€‰æ‹©æ˜¯å¦ä¿å­˜åˆ°èŠå¤©è®°å½•
   - æ”¯æŒé€‰æ‹©æ˜¯å¦æ˜¾ç¤ºåœ¨UI

2. **æ‰¹é‡æ“ä½œ**
   - æ‰¹é‡æ·»åŠ æ¶ˆæ¯
   - æ‰¹é‡ä¿å­˜èŠå¤©è®°å½•
   - å‡å°‘UIåˆ·æ–°æ¬¡æ•°

3. **é”™è¯¯æ¢å¤**
   - ç”Ÿæˆå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
   - æ”¯æŒä»æ–­ç‚¹ç»§ç»­ç”Ÿæˆ

4. **æ€§èƒ½ä¼˜åŒ–**
   - å»¶è¿ŸUIåˆ·æ–°ï¼ˆdebounceï¼‰
   - è™šæ‹Ÿæ»šåŠ¨æ”¯æŒå¤§é‡æ¶ˆæ¯
   - å¢é‡ä¿å­˜èŠå¤©è®°å½•

